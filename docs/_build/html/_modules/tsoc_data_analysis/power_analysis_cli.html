

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tsoc_data_analysis.power_analysis_cli &mdash; TSOC Data Analysis 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TSOC Data Analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TSOC Data Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tsoc_data_analysis.power_analysis_cli</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tsoc_data_analysis.power_analysis_cli</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Power System Data Analysis Command Line Tool</span>

<span class="sd">Author: Sustainable Power Systems Lab (SPSL)</span>
<span class="sd">Web: https://sps-lab.org</span>
<span class="sd">Contact: info@sps-lab.org</span>

<span class="sd">This tool performs comprehensive analysis of power system operational data from multiple Excel files.</span>
<span class="sd">It provides a complete command-line interface with enhanced configuration management and clean output formatting.</span>

<span class="sd">CONFIGURATION-DRIVEN ARCHITECTURE:</span>
<span class="sd">==================================</span>
<span class="sd">The tool follows a centralized configuration approach where all parameters, file mappings,</span>
<span class="sd">and utility functions are managed in config.py. This design ensures:</span>
<span class="sd">- Consistent parameter values across all analysis workflows</span>
<span class="sd">- Easy customization without modifying core analysis code</span>
<span class="sd">- Maintainable codebase with single source of truth for configuration</span>
<span class="sd">- Clean, readable output files using shared utility functions</span>

<span class="sd">The tool supports month-based filtering to analyze specific time periods, which significantly</span>
<span class="sd">reduces memory usage and processing time for large datasets.</span>

<span class="sd">Features:</span>
<span class="sd">- Load analysis (Total Load, Net Load) with comprehensive statistics</span>
<span class="sd">- Generator categorization (Voltage Control vs PQ Control)</span>
<span class="sd">- Wind power analysis with generation statistics</span>
<span class="sd">- Reactive power analysis with proper sign conventions</span>
<span class="sd">- Representative day extraction from load patterns</span>
<span class="sd">- Extreme day identification (minimum and maximum net load)</span>
<span class="sd">- Clean column naming for improved output readability (via config.clean_column_name)</span>
<span class="sd">- Comprehensive logging and validation</span>

<span class="sd">Data File Structure:</span>
<span class="sd">The tool expects Excel files with the following structure:</span>

<span class="sd">* Substation active power data (MW) - timestamps in column C (row 6+), </span>
<span class="sd">  substation names in row 2 (columns G, I, K, M, etc.), data in row 6+ (columns G, I, K, M, etc.)</span>
<span class="sd">* Substation reactive power data (MVAR) - same structure as active power data</span>
<span class="sd">* Generator voltage setpoints data (KV) - timestamps in column C (row 6+),</span>
<span class="sd">  generator names in row 3 (columns G, I, K, M, etc.), data in row 6+ (columns G, I, K, M, etc.)</span>
<span class="sd">* Wind farm active power data (MW) - timestamps in column C (row 6+),</span>
<span class="sd">  wind farm names in row 3 (columns G, I, K, M, O, etc.), data in row 6+ (columns G, I, K, M, O, etc.)</span>
<span class="sd">* Shunt element reactive power data (MVAR) - timestamps in column C (row 6+),</span>
<span class="sd">  shunt element names in row 3 (columns G, I, K, M, etc.), data in row 6+ (columns G, I, K, M, etc.)</span>
<span class="sd">* Generator reactive power data (MVAR) - timestamps in column C (row 6+),</span>
<span class="sd">  generator names in row 3 (columns G, I, K, M, etc.), data in row 6+ (columns G, I, K, M, etc.)</span>

<span class="sd">Usage:</span>

<span class="sd">Command Line Interface:</span>
<span class="sd">    python power_analysis_cli.py [OPTIONS] [MONTH]</span>

<span class="sd">Python Module Import:</span>
<span class="sd">    from power_analysis_cli import execute</span>
<span class="sd">    success = execute(month=&quot;2024-01&quot;, save_csv=True, save_plots=True)</span>

<span class="sd">Arguments:</span>
<span class="sd">    MONTH                  Month to filter data for (format: &quot;YYYY-MM&quot;) or None for all data</span>

<span class="sd">Command Line Examples:</span>

<span class="sd">    # Run full analysis with all outputs for January 2024</span>
<span class="sd">    python power_analysis_cli.py 2024-01 --output-dir results --data-dir &quot;raw_data&quot; --save-plots --save-csv --verbose</span>
<span class="sd">    </span>
<span class="sd">    # Run analysis with specific data directory for March 2024</span>
<span class="sd">    python power_analysis_cli.py 2024-03 --data-dir &quot;raw_data&quot; --verbose</span>
<span class="sd">    </span>
<span class="sd">    # Run analysis and save only summary report for December 2024</span>
<span class="sd">    python power_analysis_cli.py 2024-12 --output-dir results --summary-only</span>
<span class="sd">    </span>
<span class="sd">    # Run analysis for all data (no month filter)</span>
<span class="sd">    python power_analysis_cli.py --output-dir results --save-plots --save-csv</span>
<span class="sd">    </span>
<span class="sd">    # Quick analysis for a specific month with summary only</span>
<span class="sd">    python power_analysis_cli.py 2024-06 --summary-only</span>

<span class="sd">Python Script Examples:</span>

<span class="sd">    # Basic analysis for all data</span>
<span class="sd">    from power_analysis_cli import execute</span>
<span class="sd">    success, df = execute()</span>
<span class="sd">    if success:</span>
<span class="sd">        print(f&quot;Analysis completed with {len(df)} time points&quot;)</span>
<span class="sd">    </span>
<span class="sd">    # Analysis for specific month with all outputs</span>
<span class="sd">    success, df = execute(</span>
<span class="sd">        month=&quot;2024-01&quot;, </span>
<span class="sd">        data_dir=&quot;raw_data&quot;, </span>
<span class="sd">        output_dir=&quot;results&quot;, </span>
<span class="sd">        save_csv=True, </span>
<span class="sd">        save_plots=True, </span>
<span class="sd">        verbose=True</span>
<span class="sd">    )</span>
<span class="sd">    if success:</span>
<span class="sd">        # Use the dataframe for further analysis</span>
<span class="sd">        from operating_point_extractor import extract_representative_ops</span>
<span class="sd">        rep_df, diag = extract_representative_ops(df, max_power=850, MAPGL=200)</span>
<span class="sd">    </span>
<span class="sd">    # Summary only analysis</span>
<span class="sd">    success, df = execute(month=&quot;2024-12&quot;, summary_only=True, output_dir=&quot;results_dec&quot;)</span>
<span class="sd">    </span>
<span class="sd">    # Custom configuration</span>
<span class="sd">    success, df = execute(</span>
<span class="sd">        data_dir=&quot;my_data_folder&quot;,</span>
<span class="sd">        output_dir=&quot;my_results&quot;,</span>
<span class="sd">        save_csv=True,</span>
<span class="sd">        verbose=True</span>
<span class="sd">    )</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>  <span class="c1"># Use non-interactive backend for CLI</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Import our custom modules</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.power_system_analytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_total_load</span><span class="p">,</span> <span class="n">calculate_net_load</span><span class="p">,</span> <span class="n">get_load_statistics</span><span class="p">,</span> <span class="n">categorize_generators</span><span class="p">,</span> <span class="n">calculate_total_wind</span><span class="p">,</span> <span class="n">calculate_total_reactive_power</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.power_system_visualizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_load_timeseries</span><span class="p">,</span> <span class="n">plot_monthly_profile</span><span class="p">,</span> <span class="n">plot_total_load_daily_profile</span><span class="p">,</span> <span class="n">plot_net_load_daily_profile</span><span class="p">,</span> <span class="n">create_comprehensive_plots</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.power_data_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataValidator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.system_configuration</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">FILES</span><span class="p">,</span> <span class="n">COLUMN_PREFIXES</span><span class="p">,</span> <span class="n">DEFAULT_OUTPUT_DIR</span><span class="p">,</span> <span class="n">DEFAULT_VERBOSE</span><span class="p">,</span>
    <span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">PLOT_STYLE</span><span class="p">,</span> <span class="n">PLOT_PALETTE</span><span class="p">,</span>
    <span class="n">FIGURE_SIZES</span><span class="p">,</span> <span class="n">FONT_SIZES</span><span class="p">,</span> <span class="n">MIN_YEAR</span><span class="p">,</span> <span class="n">MAX_YEAR</span><span class="p">,</span> <span class="n">MIN_MONTH</span><span class="p">,</span> <span class="n">MAX_MONTH</span><span class="p">,</span>
    <span class="n">clean_column_name</span>
<span class="p">)</span>

<span class="c1"># Suppress warnings for cleaner output</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PowerAnalysisCLI">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PowerAnalysisCLI</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line interface for power system data analysis.&quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="PowerAnalysisCLI.__init__">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_DIR</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">DEFAULT_VERBOSE</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the CLI tool.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            data_dir (str): Directory containing the Excel data files</span>
<span class="sd">            output_dir (str): Directory to save output files</span>
<span class="sd">            verbose (bool): Whether to print detailed progress information</span>
<span class="sd">            month (str): Month to filter data for (format: &#39;YYYY-MM&#39; or None for all data)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># Create output directory if it doesn&#39;t exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Create logs subdirectory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;logs&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Set up logging</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;analysis_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.log&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs_dir</span> <span class="o">/</span> <span class="s1">&#39;analysis.log&#39;</span></div>

        
<div class="viewcode-block" id="PowerAnalysisCLI.log">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.log">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log a message to both console and file.&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">log_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="n">level</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">log_message</span><span class="p">)</span>
        
        <span class="c1"># Always write to log file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Ensure the logs directory exists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logs_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log_message</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># If logging fails, just print to console</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Logging error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">log_message</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.filter_data_by_month">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.filter_data_by_month">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter_data_by_month</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter DataFrame to include only data for the specified month.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Convert month string to datetime for comparison</span>
            <span class="n">month_start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">-01&quot;</span><span class="p">)</span>
            <span class="c1"># Get the last day of the month and set it to 23:59:59 to include the full day</span>
            <span class="n">month_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">month_start</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>
            
            <span class="c1"># Filter data for the specified month</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">month_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">month_end</span><span class="p">)]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtered data for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> records out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> total&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date range: </span><span class="si">{</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">filtered_df</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error filtering data by month: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.load_data">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.load_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load and merge all data files.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Starting data loading process...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtering data for month: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Processing all available data (no month filter)&quot;</span><span class="p">)</span>
            
            <span class="c1"># Step 1: Load all Excel files individually with debugging</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Step 1: Loading individual Excel files...&quot;</span><span class="p">)</span>
            <span class="n">dataframes</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="c1"># Use centralized file mapping from config</span>
            <span class="n">files_dict</span> <span class="o">=</span> <span class="n">FILES</span>
            
            <span class="k">for</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    
                    <span class="c1"># Load the Excel file with proper structure handling</span>
                    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    
                    <span class="c1"># Extract timestamps from column C (index 2), starting from row 6 (index 5)</span>
                    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Column C, starting from row 6</span>
                    
                    <span class="c1"># Convert timestamps to datetime</span>
                    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span>
                    
                    <span class="c1"># Get column names based on data type</span>
                    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;substation_mw&#39;</span><span class="p">:</span>
                        <span class="c1"># Substation names are in row 2 (index 1), columns G, I, K, M, etc.</span>
                        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Start from G (index 6), skip every other column</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">station_name</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span>  <span class="c1"># Row 2 (index 1)</span>
                                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">station_name</span><span class="p">):</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ss_mw_</span><span class="si">{</span><span class="n">station_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ss_mw_col_</span><span class="si">{</span><span class="n">col_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;substation_mvar&#39;</span><span class="p">:</span>
                        <span class="c1"># Substation names are in row 2 (index 1), columns G, I, K, M, etc.</span>
                        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Start from G (index 6), skip every other column</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">station_name</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span>  <span class="c1"># Row 2 (index 1)</span>
                                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">station_name</span><span class="p">):</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ss_mvar_</span><span class="si">{</span><span class="n">station_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ss_mvar_col_</span><span class="si">{</span><span class="n">col_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;gen_voltage&#39;</span><span class="p">:</span>
                        <span class="c1"># Generator names are in row 3 (index 2), columns G, I, K, M, etc.</span>
                        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Start from G (index 6), skip every other column</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">gen_name</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span>  <span class="c1"># Row 3 (index 2)</span>
                                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">gen_name</span><span class="p">):</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gen_v_</span><span class="si">{</span><span class="n">gen_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gen_v_col_</span><span class="si">{</span><span class="n">col_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;wind_power&#39;</span><span class="p">:</span>
                        <span class="c1"># Wind farm names are in row 3 (index 2), columns G, I, K, M, O, etc.</span>
                        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Start from G (index 6), skip every other column</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">wind_name</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span>  <span class="c1"># Row 3 (index 2)</span>
                                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">wind_name</span><span class="p">):</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wind_mw_</span><span class="si">{</span><span class="n">wind_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wind_mw_col_</span><span class="si">{</span><span class="n">col_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;shunt_elements&#39;</span><span class="p">:</span>
                        <span class="c1"># Shunt element names are in row 3 (index 2)</span>
                        <span class="c1"># shunt_mvar_* columns: G3, K3, O3, S3, W3 (names) with data at G6+, K6+, O6+, S6+, W6+</span>
                        <span class="c1"># shunt_tap_* columns: I3, M3, Q3, U3, Y3 (names) with data at I6+, M6+, Q6+, U6+, Y6+</span>
                        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[]</span>
                        
                        <span class="c1"># Define the specific column indices for mvar and tap data</span>
                        <span class="n">mvar_cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>  <span class="c1"># G, K, O, S, W</span>
                        <span class="n">tap_cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>   <span class="c1"># I, M, Q, U, Y</span>
                        
                        <span class="c1"># Process mvar columns</span>
                        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="n">mvar_cols</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">shunt_name</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span>  <span class="c1"># Row 3 (index 2)</span>
                                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">shunt_name</span><span class="p">):</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shunt_mvar_</span><span class="si">{</span><span class="n">shunt_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shunt_mvar_col_</span><span class="si">{</span><span class="n">col_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        
                        <span class="c1"># Process tap columns</span>
                        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="n">tap_cols</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">shunt_name</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span>  <span class="c1"># Row 3 (index 2)</span>
                                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">shunt_name</span><span class="p">):</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shunt_tap_</span><span class="si">{</span><span class="n">shunt_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shunt_tap_col_</span><span class="si">{</span><span class="n">col_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        
                        <span class="c1"># Log the generated column names for debugging</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated shunt column names: </span><span class="si">{</span><span class="n">col_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;gen_mvar&#39;</span><span class="p">:</span>
                        <span class="c1"># Generator names are in row 3 (index 2), columns G, I, K, M, etc.</span>
                        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Start from G (index 6), skip every other column</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">gen_name</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span>  <span class="c1"># Row 3 (index 2)</span>
                                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">gen_name</span><span class="p">):</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gen_mvar_</span><span class="si">{</span><span class="n">gen_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">col_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gen_mvar_col_</span><span class="si">{</span><span class="n">col_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Default column naming</span>
                        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">_col_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)]</span>
                    
                    <span class="c1"># Get the data starting from row 6 (index 5)</span>
                    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;shunt_elements&#39;</span><span class="p">:</span>
                        <span class="c1"># For shunt elements, process only the specific columns for mvar and tap</span>
                        <span class="c1"># shunt_mvar_*: G(6), K(10), O(14), S(18), W(22)</span>
                        <span class="c1"># shunt_tap_*: I(8), M(12), Q(16), U(20), Y(24)</span>
                        <span class="n">mvar_cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>  <span class="c1"># G, K, O, S, W</span>
                        <span class="n">tap_cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>   <span class="c1"># I, M, Q, U, Y</span>
                        
                        <span class="c1"># Process mvar columns</span>
                        <span class="n">mvar_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">col_names</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_mvar_&#39;</span><span class="p">)]</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mvar_cols</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">mvar_names</span><span class="p">):</span>
                                <span class="n">col_name</span> <span class="o">=</span> <span class="n">mvar_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="n">col_data</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Row 6 (index 5) onwards</span>
                                <span class="n">data_dict</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_data</span>
                        
                        <span class="c1"># Process tap columns</span>
                        <span class="n">tap_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">col_names</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_tap_&#39;</span><span class="p">)]</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tap_cols</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tap_names</span><span class="p">):</span>
                                <span class="n">col_name</span> <span class="o">=</span> <span class="n">tap_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="n">col_data</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Row 6 (index 5) onwards</span>
                                <span class="n">data_dict</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_data</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># For other data types, process every other column (G, I, K, M, etc.)</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">col_idx</span> <span class="o">&lt;</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">):</span>
                                <span class="n">col_name</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="n">col_data</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:,</span> <span class="n">col_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Row 6 (index 5) onwards</span>
                                <span class="n">data_dict</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_data</span>
                    
                    <span class="c1"># Create DataFrame with proper structure</span>
                    <span class="k">if</span> <span class="n">data_dict</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timestamps</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created DataFrame with shape: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            
                            <span class="c1"># Clean up the data by removing rows with NaT timestamps</span>
                            <span class="c1"># Check if index has any NaT values and remove them</span>
                            <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After removing NaT timestamps: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            
                            <span class="c1"># Convert index to datetime and sort</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After datetime conversion: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            
                            <span class="c1"># Filter by month if specified</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_data_by_month</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After month filtering: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            
                            <span class="c1"># Skip if no data remains after filtering</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">, skipping...&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
                                <span class="k">continue</span>
                            
                            <span class="c1"># Data validation will be applied to the final merged dataframe</span>
                            <span class="n">df</span> <span class="o">=</span> <span class="n">data</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating DataFrame: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                            <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traceback: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                            <span class="k">raise</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data columns found in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">, skipping...&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame shape: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">dataframes</span><span class="p">[</span><span class="n">data_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span><span class="si">}</span><span class="s2"> data files&quot;</span><span class="p">)</span>
            
            <span class="c1"># Step 2: Clean and prepare individual dataframes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Step 2: Cleaning and preparing individual dataframes...&quot;</span><span class="p">)</span>
            <span class="n">cleaned_dataframes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">keys_to_delete</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Track keys to delete after iteration</span>
            
            <span class="k">for</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaning </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Clean column names</span>
                    <span class="n">df_clean</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">cleaned_columns</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">col_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                        <span class="n">col_clean</span> <span class="o">=</span> <span class="n">col_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">col_clean</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">col_clean</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">in</span> <span class="s1">&#39; _&#39;</span><span class="p">)</span>
                        <span class="n">col_clean</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col_clean</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
                        <span class="n">col_clean</span> <span class="o">=</span> <span class="n">col_clean</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                        <span class="n">col_clean</span> <span class="o">=</span> <span class="n">col_clean</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                        <span class="n">cleaned_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_clean</span><span class="p">)</span>
                    
                    <span class="n">df_clean</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cleaned_columns</span>
                    
                    <span class="c1"># Use centralized column prefixes from config</span>
                    <span class="n">column_prefixes</span> <span class="o">=</span> <span class="n">COLUMN_PREFIXES</span>
                    
                    <span class="n">prefix</span> <span class="o">=</span> <span class="n">column_prefixes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">)</span>
                    <span class="n">df_prefixed</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">df_prefixed</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">col</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_prefixed</span><span class="o">.</span><span class="n">columns</span>
                    <span class="p">]</span>
                    
                    <span class="n">cleaned_dataframes</span><span class="p">[</span><span class="n">data_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_prefixed</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully cleaned </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2"> - shape: </span><span class="si">{</span><span class="n">df_prefixed</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Track this key for deletion after iteration</span>
                    <span class="n">keys_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
                    
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error cleaning </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Free original dataframes after iteration to save memory</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_delete</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">dataframes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            
            <span class="c1"># Step 3: Merge dataframes incrementally with conservative approach</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Step 3: Merging dataframes incrementally...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cleaned_keys_to_delete</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Track keys to delete after iteration</span>
            
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cleaned_dataframes</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging dataframe </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned_dataframes</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial dataframe created with shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Perform outer merge</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2"> (shape: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">) with existing dataframe (shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                        
                        <span class="c1"># Check for common timestamps</span>
                        <span class="n">common_timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Common timestamps: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">common_timestamps</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Perform merge with error handling</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Starting merge operation...&quot;</span><span class="p">)</span>
                            
                            <span class="c1"># Check if this merge would be too large</span>
                            <span class="n">estimated_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated merge size: </span><span class="si">{</span><span class="n">estimated_size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> cells&quot;</span><span class="p">)</span>
                            
                            <span class="c1"># Use a more conservative threshold</span>
                            <span class="k">if</span> <span class="n">estimated_size</span> <span class="o">&gt;</span> <span class="mi">5000000</span><span class="p">:</span>  <span class="c1"># 5M cells threshold (much lower)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Large merge detected, using concat approach...&quot;</span><span class="p">)</span>
                                <span class="c1"># Use concat instead of merge for very large datasets</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># Use regular merge for smaller datasets</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
                            
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merge completed. New shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">merge_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during merge operation: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">merge_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Attempting to continue with existing dataframe...&quot;</span><span class="p">)</span>
                            <span class="c1"># Continue with the existing merged_df instead of failing completely</span>
                    
                    <span class="c1"># Track this key for deletion after iteration</span>
                    <span class="n">cleaned_keys_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
                    
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error merging </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Free the individual dataframes after iteration to save memory</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cleaned_keys_to_delete</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">cleaned_dataframes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            
            <span class="c1"># Step 4: Apply final validation to merged dataframe</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Step 4: Applying final validation to merged dataframe...&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Apply comprehensive validation to the merged dataframe</span>
                    <span class="n">validator</span> <span class="o">=</span> <span class="n">DataValidator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">get_validation_summary</span><span class="p">()</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Final validation completed successfully&quot;</span><span class="p">)</span>
                    
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during final validation: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final merged DataFrame shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of columns: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.perform_analysis">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.perform_analysis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the main analysis calculations.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Starting analysis calculations...&quot;</span><span class="p">)</span>
            
            <span class="c1"># Calculate total load</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Calculating total load...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span> <span class="o">=</span> <span class="n">calculate_total_load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total load calculated for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">)</span><span class="si">}</span><span class="s2"> time points&quot;</span><span class="p">)</span>
            
            <span class="c1"># Calculate net load</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Calculating net load...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span> <span class="o">=</span> <span class="n">calculate_net_load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Net load calculated for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="p">)</span><span class="si">}</span><span class="s2"> time points&quot;</span><span class="p">)</span>
            
            <span class="c1"># Calculate total wind generation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Calculating total wind generation...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span> <span class="o">=</span> <span class="n">calculate_total_wind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total wind generation calculated for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="p">)</span><span class="si">}</span><span class="s2"> time points&quot;</span><span class="p">)</span>
            
            <span class="c1"># Calculate total reactive power</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Calculating total reactive power...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span> <span class="o">=</span> <span class="n">calculate_total_reactive_power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total reactive power calculated for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="p">)</span><span class="si">}</span><span class="s2"> time points&quot;</span><span class="p">)</span>
            
            <span class="c1"># Get load statistics</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Calculating load statistics...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span> <span class="o">=</span> <span class="n">get_load_statistics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Load statistics calculated successfully&quot;</span><span class="p">)</span>
            
            <span class="c1"># Categorize generators</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Categorizing generators...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span> <span class="o">=</span> <span class="n">categorize_generators</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voltage Control Generators: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PQ Control Generators: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during analysis: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.save_csv_data">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.save_csv_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_csv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save analysis results to CSV files.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Saving CSV data...&quot;</span><span class="p">)</span>
            
            <span class="c1"># Create month-specific filenames if month is specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                <span class="n">total_load_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;total_load_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.csv&#39;</span>
                <span class="n">net_load_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;net_load_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.csv&#39;</span>
                <span class="n">stats_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;load_statistics_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.csv&#39;</span>
                <span class="n">gen_categories_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;generator_categories_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.csv&#39;</span>
                <span class="n">all_power_data_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;all_power_data_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_load_file</span> <span class="o">=</span> <span class="s1">&#39;total_load.csv&#39;</span>
                <span class="n">net_load_file</span> <span class="o">=</span> <span class="s1">&#39;net_load.csv&#39;</span>
                <span class="n">stats_file</span> <span class="o">=</span> <span class="s1">&#39;load_statistics.csv&#39;</span>
                <span class="n">gen_categories_file</span> <span class="o">=</span> <span class="s1">&#39;generator_categories.csv&#39;</span>
                <span class="n">all_power_data_file</span> <span class="o">=</span> <span class="s1">&#39;all_power_data.csv&#39;</span>
            
            <span class="c1"># Save total load</span>
            <span class="n">total_load_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="s1">&#39;total_load_mw&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">values</span>
            <span class="p">})</span>
            <span class="n">total_load_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">total_load_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># Save net load</span>
            <span class="n">net_load_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="s1">&#39;net_load_mw&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">values</span>
            <span class="p">})</span>
            <span class="n">net_load_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">net_load_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># Save load statistics</span>
            <span class="n">stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">])</span>
            <span class="n">stats_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">stats_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># Save generator categories</span>
            <span class="n">gen_categories</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;voltage_control&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">],</span>
                <span class="s1">&#39;pq_control&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">]</span>
            <span class="p">}</span>
            
            <span class="c1"># Convert to DataFrame for easier CSV export</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gen_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">gen_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">]))</span>
            <span class="n">gen_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s1">&#39;voltage_control&#39;</span><span class="p">:</span> <span class="n">gen_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">gen_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">])),</span>
                <span class="s1">&#39;pq_control&#39;</span><span class="p">:</span> <span class="n">gen_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">gen_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">]))</span>
            <span class="p">})</span>
            <span class="n">gen_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">gen_categories_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># Save comprehensive power data CSV with all individual columns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Creating comprehensive power data CSV...&quot;</span><span class="p">)</span>
            
            <span class="c1"># Start with timestamp column</span>
            <span class="n">power_data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="p">})</span>
            
            <span class="c1"># Add all substation active power columns (ss_mw_*)</span>
            <span class="n">ss_mw_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ss_mw_&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">ss_mw_columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ss_mw_columns</span><span class="p">:</span>
                    <span class="n">clean_col_name</span> <span class="o">=</span> <span class="n">clean_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">power_data_df</span><span class="p">[</span><span class="n">clean_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ss_mw_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> substation active power columns&quot;</span><span class="p">)</span>
            
            <span class="c1"># Add all substation reactive power columns (ss_mvar_*)</span>
            <span class="n">ss_mvar_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ss_mvar_&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">ss_mvar_columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ss_mvar_columns</span><span class="p">:</span>
                    <span class="n">clean_col_name</span> <span class="o">=</span> <span class="n">clean_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">power_data_df</span><span class="p">[</span><span class="n">clean_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ss_mvar_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> substation reactive power columns&quot;</span><span class="p">)</span>
            
            <span class="c1"># Add all shunt element reactive power columns (shunt_mvar_*)</span>
            <span class="n">shunt_mvar_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_mvar_&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">shunt_mvar_columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">shunt_mvar_columns</span><span class="p">:</span>
                    <span class="n">clean_col_name</span> <span class="o">=</span> <span class="n">clean_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">power_data_df</span><span class="p">[</span><span class="n">clean_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">shunt_mvar_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> shunt element reactive power (mvar) columns&quot;</span><span class="p">)</span>
            
            <span class="c1"># Add all shunt element tap position columns (shunt_tap_*)</span>
            <span class="n">shunt_tap_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_tap_&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">shunt_tap_columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">shunt_tap_columns</span><span class="p">:</span>
                    <span class="n">clean_col_name</span> <span class="o">=</span> <span class="n">clean_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">power_data_df</span><span class="p">[</span><span class="n">clean_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">shunt_tap_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> shunt element tap position columns&quot;</span><span class="p">)</span>
            
            <span class="c1"># Add all generator reactive power columns (gen_mvar_*)</span>
            <span class="n">gen_mvar_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gen_mvar_&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">gen_mvar_columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">gen_mvar_columns</span><span class="p">:</span>
                    <span class="n">clean_col_name</span> <span class="o">=</span> <span class="n">clean_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">power_data_df</span><span class="p">[</span><span class="n">clean_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">gen_mvar_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> generator reactive power columns&quot;</span><span class="p">)</span>
            
            <span class="c1"># Add all wind power columns (wind_mw_*)</span>
            <span class="n">wind_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;wind_mw_&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">wind_columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">wind_columns</span><span class="p">:</span>
                    <span class="n">clean_col_name</span> <span class="o">=</span> <span class="n">clean_column_name</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                    <span class="n">power_data_df</span><span class="p">[</span><span class="n">clean_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> wind power columns&quot;</span><span class="p">)</span>
            
            <span class="c1"># Add total load, net load, total wind, and total reactive power</span>
            <span class="n">power_data_df</span><span class="p">[</span><span class="s1">&#39;tot_load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">values</span>
            <span class="n">power_data_df</span><span class="p">[</span><span class="s1">&#39;net_load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">values</span>
            <span class="n">power_data_df</span><span class="p">[</span><span class="s1">&#39;tot_wind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">values</span>
            <span class="n">power_data_df</span><span class="p">[</span><span class="s1">&#39;tot_reactive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">values</span>
            
            <span class="c1"># Add attribution comment at the top of the CSV</span>
            <span class="n">attribution_comment</span> <span class="o">=</span> <span class="s2">&quot;# Power System Data Analysis Tool - Sustainable Power Systems Lab (SPSL) - https://sps-lab.org</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1"># Save the comprehensive CSV with attribution</span>
            <span class="n">csv_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">all_power_data_file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">attribution_comment</span><span class="p">)</span>
                <span class="n">power_data_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Comprehensive power data CSV saved: </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CSV contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">power_data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">power_data_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;CSV data saved successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving CSV data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.save_plots">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.save_plots">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate and save plots.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Generating plots...&quot;</span><span class="p">)</span>
            
            <span class="c1"># Set style for better-looking plots</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">PLOT_STYLE</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">PLOT_PALETTE</span><span class="p">)</span>
            
            <span class="c1"># Create month-specific filenames if month is specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                <span class="n">comprehensive_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;comprehensive_analysis_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.png&#39;</span>
                <span class="n">timeseries_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;load_timeseries_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.png&#39;</span>
                <span class="n">total_daily_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;total_load_daily_profile_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.png&#39;</span>
                <span class="n">net_daily_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;net_load_daily_profile_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.png&#39;</span>
                <span class="n">monthly_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;monthly_profile_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.png&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">comprehensive_file</span> <span class="o">=</span> <span class="s1">&#39;comprehensive_analysis.png&#39;</span>
                <span class="n">timeseries_file</span> <span class="o">=</span> <span class="s1">&#39;load_timeseries.png&#39;</span>
                <span class="n">total_daily_file</span> <span class="o">=</span> <span class="s1">&#39;total_load_daily_profile.png&#39;</span>
                <span class="n">net_daily_file</span> <span class="o">=</span> <span class="s1">&#39;net_load_daily_profile.png&#39;</span>
                <span class="n">monthly_file</span> <span class="o">=</span> <span class="s1">&#39;monthly_profile.png&#39;</span>
            
            <span class="c1"># Create comprehensive plots (skip monthly analysis if analyzing single month)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                <span class="c1"># For single month analysis, create a simplified comprehensive plot without monthly analysis</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZES</span><span class="p">[</span><span class="s1">&#39;comprehensive&#39;</span><span class="p">])</span>
                
                <span class="c1"># Plot 1: Time series (top left)</span>
                <span class="n">plot_load_timeseries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                
                <span class="c1"># Plot 2: Total Load Daily Profile (top right)</span>
                <span class="n">plot_total_load_daily_profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                
                <span class="c1"># Plot 3: Net Load Daily Profile (bottom left)</span>
                <span class="n">plot_net_load_daily_profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                
                <span class="c1"># Plot 4: Statistics summary (bottom right)</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;Max Load&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                    <span class="s1">&#39;Min Load&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="s1">&#39;Mean Load&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s1">&#39;Max Net Load&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                    <span class="s1">&#39;Min Net Load&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="s1">&#39;Mean Net Load&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="p">}</span>
                
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Load Statistics Summary&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Statistics&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Load (MW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">)))</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">comprehensive_file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For full analysis, use the original comprehensive plots with monthly analysis</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">create_comprehensive_plots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">comprehensive_file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Create individual plots</span>
            <span class="c1"># Time series plot</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZES</span><span class="p">[</span><span class="s1">&#39;timeseries&#39;</span><span class="p">])</span>
            <span class="n">plot_load_timeseries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">timeseries_file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Total Load Daily profile plot</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZES</span><span class="p">[</span><span class="s1">&#39;daily_profile&#39;</span><span class="p">])</span>
            <span class="n">plot_total_load_daily_profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">total_daily_file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Net Load Daily profile plot</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZES</span><span class="p">[</span><span class="s1">&#39;daily_profile&#39;</span><span class="p">])</span>
            <span class="n">plot_net_load_daily_profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">net_daily_file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Monthly profile plot (only create when not analyzing a single month)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZES</span><span class="p">[</span><span class="s1">&#39;monthly_profile&#39;</span><span class="p">])</span>
                <span class="n">plot_monthly_profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">monthly_file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Plots saved successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving plots: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_json_serializable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert numpy/pandas types to JSON serializable Python types.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            obj: Object to convert</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            JSON serializable object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_json_serializable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_json_serializable</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
    
<div class="viewcode-block" id="PowerAnalysisCLI.generate_summary_report">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.generate_summary_report">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_summary_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a comprehensive summary report.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Generating summary report...&quot;</span><span class="p">)</span>
            
            <span class="c1"># Generate detailed validation summary report first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_validation_summary_report</span><span class="p">()</span>
            
            <span class="c1"># Create month-specific filenames if month is specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                <span class="n">json_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;analysis_summary_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.json&#39;</span>
                <span class="n">txt_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;analysis_summary_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.txt&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">json_file</span> <span class="o">=</span> <span class="s1">&#39;analysis_summary.json&#39;</span>
                <span class="n">txt_file</span> <span class="o">=</span> <span class="s1">&#39;analysis_summary.txt&#39;</span>
            
            <span class="c1"># Find timestamps for min/max values</span>
            <span class="n">max_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="n">min_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            <span class="n">max_net_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="n">min_net_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            <span class="n">max_wind_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="n">min_wind_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            <span class="n">max_reactive_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="n">min_reactive_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            
            <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;analysis_timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;month_filter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                <span class="s1">&#39;data_overview&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;total_time_points&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">),</span>
                    <span class="s1">&#39;time_range_start&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;time_range_end&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;total_variables&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                <span class="p">},</span>
                <span class="s1">&#39;load_analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;max_total_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;max_load&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;max_total_load_timestamp&#39;</span><span class="p">:</span> <span class="n">max_load_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;min_total_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;min_load&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;min_total_load_timestamp&#39;</span><span class="p">:</span> <span class="n">min_load_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;mean_total_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;mean_load&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;std_total_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;std_load&#39;</span><span class="p">])</span>
                <span class="p">},</span>
                <span class="s1">&#39;generator_analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;voltage_control_generators&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;pq_control_generators&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;total_voltage_control&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;total_pq_control&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">])</span>
                <span class="p">},</span>
                <span class="s1">&#39;net_load_analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;max_net_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                    <span class="s1">&#39;max_net_load_timestamp&#39;</span><span class="p">:</span> <span class="n">max_net_load_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;min_net_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                    <span class="s1">&#39;min_net_load_timestamp&#39;</span><span class="p">:</span> <span class="n">min_net_load_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;mean_net_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                    <span class="s1">&#39;std_net_load_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
                <span class="p">},</span>
                <span class="s1">&#39;wind_analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;max_total_wind_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                    <span class="s1">&#39;max_total_wind_timestamp&#39;</span><span class="p">:</span> <span class="n">max_wind_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;min_total_wind_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                    <span class="s1">&#39;min_total_wind_timestamp&#39;</span><span class="p">:</span> <span class="n">min_wind_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;mean_total_wind_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                    <span class="s1">&#39;std_total_wind_mw&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
                <span class="p">},</span>
                <span class="s1">&#39;reactive_power_analysis&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;max_total_reactive_mvar&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                    <span class="s1">&#39;max_total_reactive_timestamp&#39;</span><span class="p">:</span> <span class="n">max_reactive_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;min_total_reactive_mvar&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                    <span class="s1">&#39;min_total_reactive_timestamp&#39;</span><span class="p">:</span> <span class="n">min_reactive_idx</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s1">&#39;mean_total_reactive_mvar&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                    <span class="s1">&#39;std_total_reactive_mvar&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
                <span class="p">},</span>
                <span class="s1">&#39;data_validation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="p">}</span>
            
            <span class="c1"># Convert report to JSON serializable format</span>
            <span class="n">report_serializable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_json_serializable</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
            
            <span class="c1"># Save as JSON</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">json_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report_serializable</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># Save as text report</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">txt_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=== POWER SYSTEM ANALYSIS SUMMARY ===</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis Date: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Month Filter: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DATA OVERVIEW:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total time points: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;data_overview&#39;</span><span class="p">][</span><span class="s1">&#39;total_time_points&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time range: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;data_overview&#39;</span><span class="p">][</span><span class="s1">&#39;time_range_start&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;data_overview&#39;</span><span class="p">][</span><span class="s1">&#39;time_range_end&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total variables: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;data_overview&#39;</span><span class="p">][</span><span class="s1">&#39;total_variables&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LOAD ANALYSIS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Total Load: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_total_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_total_load_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Total Load: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_total_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_total_load_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Total Load: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;mean_total_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Load Standard Deviation: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;std_total_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;NET LOAD ANALYSIS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Net Load: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;net_load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_net_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;net_load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_net_load_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Net Load: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;net_load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_net_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;net_load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_net_load_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Net Load: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;net_load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;mean_net_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Net Load Standard Deviation: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;net_load_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;std_net_load_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WIND GENERATION ANALYSIS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Total Wind: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;wind_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_total_wind_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;wind_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_total_wind_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Total Wind: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;wind_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_total_wind_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;wind_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_total_wind_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Total Wind: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;wind_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;mean_total_wind_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Wind Generation Standard Deviation: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;wind_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;std_total_wind_mw&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;REACTIVE POWER ANALYSIS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Total Reactive Power: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;reactive_power_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_total_reactive_mvar&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;reactive_power_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;max_total_reactive_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Total Reactive Power: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;reactive_power_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_total_reactive_mvar&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR (at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;reactive_power_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;min_total_reactive_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Total Reactive Power: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;reactive_power_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;mean_total_reactive_mvar&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Reactive Power Standard Deviation: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;reactive_power_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;std_total_reactive_mvar&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;GENERATOR ANALYSIS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Voltage Control Generators: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;generator_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;total_voltage_control&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  PQ Control Generators: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;generator_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;total_pq_control&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Voltage Control List: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;generator_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;voltage_control_generators&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  PQ Control List: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;generator_analysis&#39;</span><span class="p">][</span><span class="s1">&#39;pq_control_generators&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># Add validation summary</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DATA VALIDATION SUMMARY:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type Errors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Limit Errors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Gaps Filled: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_filled&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Gaps Too Large: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_too_large&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Values Rounded: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;values_rounded&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Rows Removed Due to Gaps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;rows_removed_due_to_gaps&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total Records Processed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;total_records_processed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Records with Errors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;records_with_errors&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Add detailed error information</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TYPE ERRORS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Show first 10 errors</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LIMIT ERRORS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Show first 10 errors</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Analysis completed successfully!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Summary report generated successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating summary report: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.generate_validation_summary_report">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.generate_validation_summary_report">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_validation_summary_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a detailed validation summary report as a separate file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;No validation summary available to generate report&quot;</span><span class="p">,</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
            <span class="k">return</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Generating detailed validation summary report...&quot;</span><span class="p">)</span>
            
            <span class="c1"># Create month-specific filename if month is specified</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                <span class="n">validation_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;validation_summary_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">.txt&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">validation_file</span> <span class="o">=</span> <span class="s1">&#39;validation_summary.txt&#39;</span>
            
            <span class="n">validation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">validation_file</span>
            
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">validation_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;POWER SYSTEM DATA VALIDATION SUMMARY REPORT</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Author: Sustainable Power Systems Lab (SPSL)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Web: https://sps-lab.org</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Contact: info@sps-lab.org</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report Generated: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Period: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Data Period: All available data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Time Points Processed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Variables Processed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># === VALIDATION OVERVIEW ===</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;VALIDATION PROCESS OVERVIEW</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Records Processed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;total_records_processed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Records with Validation Issues: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;records_with_errors&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Type Violations: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors_count&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Limit Violations: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors_count&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gaps Successfully Filled: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_filled&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gaps Too Large to Fill: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_too_large&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Values Rounded: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;values_rounded&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rows Removed Due to Excessive Gaps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;rows_removed_due_to_gaps&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># === DATA TYPE VIOLATIONS ===</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">]:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DATA TYPE VIOLATIONS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Type Violations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Description: These violations occur when data cannot be converted to the expected</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;numeric format. Common causes include text values in numeric columns or</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;missing data represented as text.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Treatment: Non-numeric values are converted to NaN (Not a Number) to maintain</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;data integrity while allowing the analysis to continue.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Group violations by column for better organization</span>
                    <span class="n">column_violations</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">]:</span>
                        <span class="c1"># Extract column name from error message</span>
                        <span class="k">if</span> <span class="s1">&#39;Column &#39;</span> <span class="ow">in</span> <span class="n">error</span> <span class="ow">and</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">error</span><span class="p">:</span>
                            <span class="n">column</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Column &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column_violations</span><span class="p">:</span>
                                <span class="n">column_violations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">column_violations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DETAILED TYPE VIOLATIONS BY COLUMN:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">violations</span> <span class="ow">in</span> <span class="n">column_violations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ss_mw_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Substation Active Power (MW)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ss_mvar_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Substation Reactive Power (MVAR)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;wind_mw_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Wind Farm Active Power (MW)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gen_v_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Generator Voltage Setpoint (KV)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gen_mvar_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Generator Reactive Power (MVAR)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_mvar_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Shunt Element Reactive Power (MVAR)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_tap_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Shunt Element Tap Position (Integer)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Unknown/Other</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Violations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">violations</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">violation</span> <span class="ow">in</span> <span class="n">violations</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Show first 5 per column</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    • </span><span class="si">{</span><span class="n">violation</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">violations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    • ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">violations</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2"> more violations</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Add detailed timestamp information for type violations</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;detailed_violations&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="ow">and</span> 
                        <span class="s1">&#39;type_violations&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;type_violations&#39;</span><span class="p">]):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SPECIFIC TYPE VIOLATION TIMESTAMPS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">violation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;type_violations&#39;</span><span class="p">][:</span><span class="mi">15</span><span class="p">]:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• </span><span class="si">{</span><span class="n">violation</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">violation</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">violation</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;type_violations&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
                            <span class="n">remaining</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;type_violations&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">15</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> more type violations</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Note: Only the first 5 violations per column are shown above.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total violations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># === LIMIT VIOLATIONS ===</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">]:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LIMIT VIOLATIONS AND CORRECTIONS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Limit Violations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Description: These violations occur when values fall outside the expected</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;operational ranges for power system equipment. Limits are defined based on</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;engineering constraints and typical operational parameters.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Treatment: Values exceeding limits are either corrected (clamped to valid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ranges) or flagged for further investigation depending on the severity.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Group limit violations by column</span>
                    <span class="n">limit_violations</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">]:</span>
                        <span class="c1"># Extract column name from error message</span>
                        <span class="k">if</span> <span class="s1">&#39;Column &#39;</span> <span class="ow">in</span> <span class="n">error</span> <span class="ow">and</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">error</span><span class="p">:</span>
                            <span class="n">column</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Column &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">limit_violations</span><span class="p">:</span>
                                <span class="n">limit_violations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">limit_violations</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DETAILED LIMIT VIOLATIONS BY COLUMN:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">violations</span> <span class="ow">in</span> <span class="n">limit_violations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ss_mw_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Substation Active Power (MW)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Expected Range: 0 to 1000 MW</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ss_mvar_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Substation Reactive Power (MVAR)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Expected Range: -500 to 500 MVAR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;wind_mw_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Wind Farm Active Power (MW)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Expected Range: 0 to 500 MW</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gen_v_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Generator Voltage Setpoint (KV)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Expected Range: 0.9 to 1.1 KV</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gen_mvar_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Generator Reactive Power (MVAR)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Expected Range: -300 to 300 MVAR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_mvar_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Shunt Element Reactive Power (MVAR)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Expected Range: -100 to 100 MVAR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;shunt_tap_&#39;</span><span class="p">):</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Shunt Element Tap Position</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Expected Range: 1 to 32 (Integer)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Type: Unknown/Other</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Violations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">violations</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">violation</span> <span class="ow">in</span> <span class="n">violations</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Show first 5 per column</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    • </span><span class="si">{</span><span class="n">violation</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">violations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    • ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">violations</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2"> more violations</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Add detailed timestamp information for limit violations</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;detailed_violations&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="ow">and</span> 
                        <span class="s1">&#39;limit_violations&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;limit_violations&#39;</span><span class="p">]):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SPECIFIC LIMIT VIOLATION TIMESTAMPS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">violation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;limit_violations&#39;</span><span class="p">][:</span><span class="mi">15</span><span class="p">]:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• </span><span class="si">{</span><span class="n">violation</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">violation</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">violation</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;limit_violations&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
                            <span class="n">remaining</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;limit_violations&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">15</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> more limit violations</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Note: Only the first 5 violations per column are shown above.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total violations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># === GAP FILLING SUMMARY ===</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;GAP FILLING PROCESS SUMMARY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Description: Missing data points (gaps) in time series are identified and</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;filled using appropriate interpolation methods to maintain data continuity.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Gap Filling Methods:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Small gaps (≤3 time steps): Linear interpolation</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Medium gaps (4-6 steps): Cubic spline interpolation (if enhanced validation enabled)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Large gaps (≥24 steps): Marked for removal to maintain data integrity</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gap Filling Results:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• Successfully filled gaps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_filled&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• Gaps too large to fill: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_too_large&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• Rows removed due to excessive gaps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;rows_removed_due_to_gaps&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># Add detailed gap filling timestamps</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;detailed_violations&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="ow">and</span> 
                    <span class="s1">&#39;gap_filling_events&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;gap_filling_events&#39;</span><span class="p">]):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SPECIFIC GAP FILLING EVENTS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">gap_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;gap_filling_events&#39;</span><span class="p">]</span>
                    <span class="n">filled_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">gap_events</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear_interpolation&#39;</span><span class="p">]</span>
                    <span class="n">too_large_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">gap_events</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not_filled_too_large&#39;</span><span class="p">]</span>
                    
                    <span class="k">if</span> <span class="n">filled_events</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Gaps Successfully Filled (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filled_events</span><span class="p">)</span><span class="si">}</span><span class="s2"> events):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">filled_events</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Show first 10</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;start_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;end_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - &quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filled_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filled_events</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more gap fills</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">too_large_events</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Gaps Too Large to Fill (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">too_large_events</span><span class="p">)</span><span class="si">}</span><span class="s2"> events):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">too_large_events</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Show first 10</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;start_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;end_timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - &quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">too_large_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">too_large_events</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2"> more large gaps</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_filled&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Treatment Applied: Linear interpolation was used to estimate missing values</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;based on surrounding data points. This method preserves trends while</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;maintaining reasonable estimates for short-term missing data.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_too_large&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Large Gap Handling: Gaps exceeding the maximum threshold were left as NaN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;to avoid introducing unreliable interpolated values over extended periods.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;These may require special attention in subsequent analysis.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;rows_removed_due_to_gaps&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Row Removal: Time points with excessive missing data across multiple</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;variables were removed to maintain overall data quality.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># === VALUE ROUNDING SUMMARY ===</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;values_rounded&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;VALUE ROUNDING SUMMARY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Values Rounded: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;values_rounded&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Description: Certain columns require integer values (e.g., shunt tap positions)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;but may contain fractional values due to data collection or processing.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Treatment: Fractional values in integer columns (primarily shunt_tap_*)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;are rounded to the nearest integer to maintain data type consistency</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;while preserving the closest valid operational state.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Add detailed rounding timestamps</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;detailed_violations&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="ow">and</span> 
                        <span class="s1">&#39;rounding_events&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;rounding_events&#39;</span><span class="p">]):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SPECIFIC ROUNDING EVENTS:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">rounding_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;detailed_violations&#39;</span><span class="p">][</span><span class="s1">&#39;rounding_events&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">rounding_events</span><span class="p">[:</span><span class="mi">15</span><span class="p">]:</span>  <span class="c1"># Show first 15</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">)</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rounded </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;original_value&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;rounded_value&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rounding_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
                            <span class="n">remaining</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rounding_events</span><span class="p">)</span> <span class="o">-</span> <span class="mi">15</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... and </span><span class="si">{</span><span class="n">remaining</span><span class="si">}</span><span class="s2"> more rounding events</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># === ENHANCED VALIDATION SUMMARY (if available) ===</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;statistical_outliers_count&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span> <span class="ow">or</span> 
                    <span class="s1">&#39;rate_violations_count&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ENHANCED VALIDATION SUMMARY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Description: Advanced validation techniques were applied to detect</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;anomalous patterns and operational inconsistencies.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="s1">&#39;statistical_outliers_count&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Statistical Outliers Detected: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;statistical_outliers_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;rate_violations_count&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate of Change Violations: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rate_violations_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;correlation_anomalies_count&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlation Anomalies: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;correlation_anomalies_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;power_balance_violations_count&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Power Balance Violations: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;power_balance_violations_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># === SUMMARY AND RECOMMENDATIONS ===</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;VALIDATION SUMMARY AND RECOMMENDATIONS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">total_issues</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors_count&#39;</span><span class="p">]</span> <span class="o">+</span> 
                              <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors_count&#39;</span><span class="p">]</span> <span class="o">+</span> 
                              <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_too_large&#39;</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="n">total_issues</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;✓ EXCELLENT: No significant validation issues detected.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  The dataset appears to be of high quality with minimal problems.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">total_issues</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;✓ GOOD: Minor validation issues detected but overall data quality is acceptable.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  The issues found are typical for real-world power system data.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">total_issues</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;⚠ MODERATE: Some validation issues detected that may affect analysis quality.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Review the detailed violations above for specific concerns.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;⚠ SIGNIFICANT: Multiple validation issues detected.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  Consider reviewing data collection and processing procedures.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Data Quality Assessment:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">data_quality_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="n">total_issues</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• Overall Data Quality Score: </span><span class="si">{</span><span class="n">data_quality_score</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• Time Coverage: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> time points</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• Variable Coverage: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> variables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• Successful Gap Fills: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_filled&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Recommendations:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Review data collection procedures to minimize non-numeric entries</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors_count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Investigate equipment operating outside normal parameters</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_too_large&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Consider improving data acquisition systems to reduce large gaps</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;rows_removed_due_to_gaps&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Review periods with excessive missing data for potential system issues</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Next Steps:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Proceed with power system analysis using the validated dataset</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Monitor validation reports for trends in data quality over time</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;• Consider implementing enhanced validation for critical analysis periods</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;END OF VALIDATION SUMMARY REPORT</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">80</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detailed validation summary saved to: </span><span class="si">{</span><span class="n">validation_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating validation summary report: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.print_summary">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.print_summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a summary to the console.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;POWER SYSTEM ANALYSIS SUMMARY&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Month Filter: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Overview:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total time points: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time range: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total variables: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">merged_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Find timestamps for min/max values for console output</span>
        <span class="n">max_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="n">min_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_load</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        <span class="n">max_net_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="n">min_net_load_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        <span class="n">max_wind_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="n">min_wind_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        <span class="n">max_reactive_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="n">min_reactive_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Load Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Total Load: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;max_load&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">max_load_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Total Load: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;min_load&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">min_load_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Total Load: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;mean_load&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Load Standard Deviation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">load_stats</span><span class="p">[</span><span class="s1">&#39;std_load&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Net Load Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Net Load: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">max_net_load_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Net Load: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">min_net_load_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Net Load: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Net Load Standard Deviation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">net_load</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Wind Generation Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Total Wind: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">max_wind_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Total Wind: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW (at </span><span class="si">{</span><span class="n">min_wind_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Total Wind: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Wind Generation Standard Deviation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_wind</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reactive Power Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Maximum Total Reactive Power: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR (at </span><span class="si">{</span><span class="n">max_reactive_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum Total Reactive Power: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR (at </span><span class="si">{</span><span class="n">min_reactive_idx</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average Total Reactive Power: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Reactive Power Standard Deviation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_reactive_power</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MVAR&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generator Analysis:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Voltage Control Generators: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;voltage_control&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  PQ Control Generators: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator_categories</span><span class="p">[</span><span class="s1">&#39;pq_control&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add validation summary to console output</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Validation Summary:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type Errors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;type_errors_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Limit Errors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;limit_errors_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Gaps Filled: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_filled&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Gaps Too Large: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;gaps_too_large&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Values Rounded: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;values_rounded&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Rows Removed Due to Gaps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;rows_removed_due_to_gaps&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total Records Processed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;total_records_processed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Records with Errors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_summary</span><span class="p">[</span><span class="s1">&#39;records_with_errors&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Output files saved to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="PowerAnalysisCLI.run_analysis">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.PowerAnalysisCLI.run_analysis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_csv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">summary_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the complete analysis pipeline.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Starting power system analysis...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Load data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Perform analysis</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_analysis</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Generate summary report</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_summary_report</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Print summary to console</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span>
        
        <span class="c1"># Save additional outputs if requested</span>
        <span class="k">if</span> <span class="n">save_csv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">summary_only</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_csv_data</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        
        <span class="k">if</span> <span class="n">save_plots</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">summary_only</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_plots</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Analysis completed successfully!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="execute">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.execute">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_DIR</span><span class="p">,</span> 
           <span class="n">save_csv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">summary_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">DEFAULT_VERBOSE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the power system analysis with specified parameters.</span>
<span class="sd">    </span>
<span class="sd">    This function can be called directly from other Python scripts to perform</span>
<span class="sd">    power system data analysis without using the command line interface. It follows</span>
<span class="sd">    a configuration-driven approach for consistent, maintainable analysis.</span>

<span class="sd">    CONFIGURATION INTEGRATION:</span>
<span class="sd">    ==========================</span>
<span class="sd">    - Uses centralized file mappings from config.FILES</span>
<span class="sd">    - Applies column prefixes from config.COLUMN_PREFIXES  </span>
<span class="sd">    - Leverages data validation settings from config.DATA_VALIDATION</span>
<span class="sd">    - Generates clean column names using config.clean_column_name()</span>
<span class="sd">    - Creates outputs with standardized naming conventions</span>

<span class="sd">    OUTPUT FEATURES:</span>
<span class="sd">    ===============</span>
<span class="sd">    - CSV files with clean, readable column names (removes verbose suffixes)</span>
<span class="sd">    - Comprehensive power data CSV with all variables and calculated metrics</span>
<span class="sd">    - JSON and text summary reports with detailed analysis results</span>
<span class="sd">    - PNG plots with professional styling and clear visualizations</span>
<span class="sd">    - Detailed validation reports with data quality assessment</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        month (str, optional): Month to filter data for (format: &quot;YYYY-MM&quot;) or None for all data.</span>
<span class="sd">                              Examples: &quot;2024-01&quot;, &quot;2024-12&quot;, None</span>
<span class="sd">        data_dir (str): Directory containing the Excel data files (default: from config.DATA_DIR)</span>
<span class="sd">        output_dir (str): Directory to save output files (default: from config.DEFAULT_OUTPUT_DIR)</span>
<span class="sd">        save_csv (bool): Save analysis results to CSV files with clean column names (default: False)</span>
<span class="sd">        save_plots (bool): Generate and save plots as PNG files (default: False)</span>
<span class="sd">        summary_only (bool): Generate only summary report, no CSV or plots (default: False)</span>
<span class="sd">        verbose (bool): Print detailed progress information (default: from config.DEFAULT_VERBOSE)</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        tuple: (success, all_power_df) where:</span>
<span class="sd">            - success (bool): True if analysis completed successfully, False otherwise</span>
<span class="sd">            - all_power_df (pandas.DataFrame or None): The merged power system dataframe </span>
<span class="sd">              containing all loaded and processed data with original column names.</span>
<span class="sd">              None if analysis failed. This dataframe can be used for further analysis</span>
<span class="sd">              such as calling extract_representative_ops().</span>
<span class="sd">        </span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If month format is invalid or data directory doesn&#39;t exist</span>
<span class="sd">        </span>
<span class="sd">    Examples:</span>

<span class="sd">        # Basic analysis for all data</span>
<span class="sd">        success, df = execute()</span>
<span class="sd">        if success:</span>
<span class="sd">            print(f&quot;Analysis completed with {len(df)} time points&quot;)</span>
<span class="sd">        </span>
<span class="sd">        # Analysis for specific month with plots and CSV</span>
<span class="sd">        success, df = execute(month=&quot;2024-01&quot;, save_csv=True, save_plots=True, verbose=True)</span>
<span class="sd">        if success:</span>
<span class="sd">            # Use dataframe for representative operations analysis</span>
<span class="sd">            from operating_point_extractor import extract_representative_ops</span>
<span class="sd">            rep_df, diag = extract_representative_ops(df, max_power=850, MAPGL=200)</span>
<span class="sd">        </span>
<span class="sd">        # Summary only for a specific month</span>
<span class="sd">        success, df = execute(month=&quot;2024-12&quot;, summary_only=True, output_dir=&quot;results_dec&quot;)</span>
<span class="sd">        </span>
<span class="sd">        # Custom data directory</span>
<span class="sd">        success, df = execute(data_dir=&quot;my_data&quot;, output_dir=&quot;my_results&quot;, save_csv=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate data directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data directory &#39;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Validate month format if provided</span>
    <span class="k">if</span> <span class="n">month</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate month format (YYYY-MM)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">and</span> <span class="n">month</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid format&quot;</span><span class="p">)</span>
            
            <span class="n">year</span><span class="p">,</span> <span class="n">month_part</span> <span class="o">=</span> <span class="n">month</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">year_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="n">month_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">month_part</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">MIN_YEAR</span> <span class="o">&lt;=</span> <span class="n">year_int</span> <span class="o">&lt;=</span> <span class="n">MAX_YEAR</span> <span class="ow">and</span> <span class="n">MIN_MONTH</span> <span class="o">&lt;=</span> <span class="n">month_int</span> <span class="o">&lt;=</span> <span class="n">MAX_MONTH</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid year or month&quot;</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid month format &#39;</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">&#39;. Expected format: YYYY-MM (e.g., 2024-01)&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create CLI instance</span>
    <span class="n">cli</span> <span class="o">=</span> <span class="n">PowerAnalysisCLI</span><span class="p">(</span>
        <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">month</span><span class="o">=</span><span class="n">month</span>
    <span class="p">)</span>
    
    <span class="c1"># Run analysis</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">run_analysis</span><span class="p">(</span>
        <span class="n">save_csv</span><span class="o">=</span><span class="n">save_csv</span><span class="p">,</span>
        <span class="n">save_plots</span><span class="o">=</span><span class="n">save_plots</span><span class="p">,</span>
        <span class="n">summary_only</span><span class="o">=</span><span class="n">summary_only</span>
    <span class="p">)</span>
    
    <span class="c1"># Return both success status and the merged dataframe</span>
    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">success</span><span class="p">,</span> <span class="n">cli</span><span class="o">.</span><span class="n">merged_df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../api/power_analysis_cli.html#tsoc_data_analysis.power_analysis_cli.main">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function to handle command line arguments and run analysis.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Power System Data Analysis Command Line Tool&#39;</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Examples:</span>
<span class="s2">  # Basic analysis</span>
<span class="s2">  python power_analysis_cli.py --output-dir results --save-plots --save-csv</span>
<span class="s2">  python power_analysis_cli.py --data-dir &quot;raw_data&quot; --verbose</span>
<span class="s2">  python power_analysis_cli.py --output-dir results --summary-only</span>
<span class="s2">  </span>
<span class="s2">  # Month-specific analysis</span>
<span class="s2">  python power_analysis_cli.py 2024-01 --output-dir results --save-plots --save-csv</span>
<span class="s2">  python power_analysis_cli.py 2024-03 --data-dir &quot;raw_data&quot; --verbose</span>
<span class="s2">  python power_analysis_cli.py 2024-12 --output-dir results --summary-only</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;month&#39;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Month to filter data for (format: &quot;YYYY-MM&quot;) or None for all data&#39;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--data-dir&#39;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">DATA_DIR</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Directory containing the Excel data files (default: &quot;</span><span class="si">{</span><span class="n">DATA_DIR</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--output-dir&#39;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_DIR</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Directory to save output files (default: &quot;</span><span class="si">{</span><span class="n">DEFAULT_OUTPUT_DIR</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--save-csv&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Save analysis results to CSV files&#39;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--save-plots&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Generate and save plots as PNG files&#39;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--summary-only&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Generate only summary report (no CSV or plots)&#39;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--verbose&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Print detailed progress information&#39;</span>
    <span class="p">)</span>
    
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;--version&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s1">&#39;Power System Analysis CLI v1.0&#39;</span>
    <span class="p">)</span>
    
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Call the execute function with parsed arguments</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">all_power_df</span> <span class="o">=</span> <span class="n">execute</span><span class="p">(</span>
            <span class="n">month</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
            <span class="n">save_csv</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">save_csv</span><span class="p">,</span>
            <span class="n">save_plots</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">save_plots</span><span class="p">,</span>
            <span class="n">summary_only</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">summary_only</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">verbose</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis failed. Check the log file for details.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis completed successfully!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_power_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> time points with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_power_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> variables.&quot;</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span> 
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Sustainable Power Systems Lab (SPSL).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>